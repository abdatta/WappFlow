# wapp-flow

**wapp-flow** is a powerful, locally hosted Progressive Web App (PWA) for scheduling and automating WhatsApp messages. It leverages a modern tech stack to provide meaningful automation without relying on the official WhatsApp Business API, making it suitable for personal use or small-scale automation.

## ğŸš€ Features

- **Automated Messaging**: Send WhatsApp messages automatically using a real browser instance (Playwright).
- **Flexible Scheduling**:
  - **Instant**: Send messages immediately.
  - **One-time**: Schedule messages for a specific future date and time.
  - **Recurring**: Set up recurring schedules (e.g., every 30 minutes, daily, weekly).
- **Message History**: Track the status of all your messages (sending, sent, failed) with a detailed history log.
- **Modern PWA Interface**: A responsive, installable web application built with Preact and Vite.
- **No API Costs**: Uses your existing WhatsApp Web session.
- **Privacy Focused**: All data (schedules, logs, session) is stored locally on your machine using SQLite.

## ğŸ› ï¸ Tech Stack

**Frontend**

- **Framework**: [Preact](https://preactjs.com/) (Lightweight React alternative)
- **Build Tool**: [Vite](https://vitejs.dev/)
- **Routing**: [Wouter](https://github.com/molefrog/wouter)
- **Styling**: Vanilla CSS (Mobile-first, Dark/Light mode aware)
- **PWA**: [vite-plugin-pwa](https://vite-plugin-pwa.netlify.app/)

**Backend**

- **Runtime**: [Node.js](https://nodejs.org/) & TypeScript
- **Server**: [Express](https://expressjs.com/)
- **Database**: [Better-SQLite3](https://github.com/WiseLibs/better-sqlite3)
- **Automation**: [Playwright](https://playwright.dev/) (Chromium)
- **Scheduler**: [node-schedule](https://github.com/node-schedule/node-schedule)

## ğŸ“‹ Prerequisites

- **Node.js**: v18 or higher recommended.
- **npm**: v9 or higher (supports workspaces).
- **Git**: To clone the repository.
- **WhatsApp Account**: A valid WhatsApp account on a mobile device.

## âš¡ Installation & Setup

1. **Clone the Repository**

   ```bash
   git clone https://github.com/abdatta/wapp-flow.git
   cd wapp-flow
   ```

2. **Install Dependencies**
   The project is configured with npm workspaces. Installing dependencies at the root will set up both the backend and the frontend.

   ```bash
   npm install
   ```

   _Note: This installs backend dependencies in the root `node_modules` and frontend dependencies in `client/node_modules`._

3. **Configure Environment**
   Copy the example environment file to create your local configuration:

   ```bash
   cp .env.example .env
   ```

   You can edit `.env` to configure the `PORT` (default is 3000).

4. **Start Development Server**
   To run both the backend server and the frontend client concurrently:

   ```bash
   npm run dev
   ```

   - **Frontend**: Accessible at `http://localhost:5173`
   - **Backend**: Runs on `http://localhost:3000`

## ğŸ”„ Auto-start on Boot

### Windows

To ensure the application starts automatically when your Windows machine restarts:

1.  **Locate the Startup Script**:
    There is a `scripts\wappflow_startup.bat` file in the project.

2.  **Add to Startup Folder**:
    - Press `Win + R`, type `shell:startup`, and press Enter. This opens your user's Startup folder.
    - **Right-click** and drag the `scripts\wappflow_startup.bat` file from the project folder into the Startup folder.
    - Select **"Create shortcuts here"** from the context menu.

### Linux & macOS

For Unix-based systems, you can use the `scripts/wappflow_startup.sh` script manually, but the recommended way to ensure auto-start on boot is using PM2's native startup generation:

1.  **Start the app once**:

    ```bash
    npm run start:pm2
    ```

2.  **Generate startup script**:

    ```bash
    npx pm2 startup
    ```

    _Build the command output by PM2 and run it._

3.  **Freeze process list**:
    ```bash
    npx pm2 save
    ```

Alternatively, you can use the provided script for manual starting:

```bash
./scripts/wappflow_startup.sh
```

## ğŸ”— Connecting WhatsApp

1. Open the application at `http://localhost:5173`.
2. Navigate to the **Connect** (or Status) page.
3. You will see a QR code generated by the backend.
4. Open **WhatsApp** on your phone.
5. Go to **Settings** > **Linked Devices** > **Link a Device**.
6. Scan the QR code.
7. Once authenticated, the status will update to **Authenticated**.

> **Note**: The session is saved locally in the `data/whatsapp_session` directory. You do not need to scan the QR code every time you restart the server, provided the session remains valid.

## ğŸ“‚ Project Structure

```
wapp-flow/
â”œâ”€â”€ client/                 # Frontend (Preact) application
â”‚   â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ public/
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ src/                    # Backend (Node.js) application
â”‚   â”œâ”€â”€ api/                # Express routes
â”‚   â”œâ”€â”€ db/                 # Database initialization & migrations
â”‚   â”œâ”€â”€ services/           # Core logic (WhatsApp, Scheduler)
â”‚   â”œâ”€â”€ utils/              # Helper functions (Logger)
â”‚   â””â”€â”€ server.ts           # Entry point
â”œâ”€â”€ shared/                 # Types shared between Frontend and Backend
â”œâ”€â”€ data/                   # SQLite DB & WhatsApp Session (gitignored)
â”œâ”€â”€ package.json            # Root configuration & scripts
â””â”€â”€ tsconfig.json           # TypeScript configuration
```

## ğŸ“œ Scripts

- `npm run dev`: Run both client and server in watch mode.
- `npm run build`: Build both client and server for production.
- `npm start`: Start the production server (requires build).
- `npm run format`: Format code using Prettier.

## ğŸ¤ Contributing

1. Fork the repository.
2. Create your feature branch (`git checkout -b feature/AmazingFeature`).
3. Commit your changes (`git commit -m 'Add some AmazingFeature'`).
4. Push to the branch (`git push origin feature/AmazingFeature`).
5. Open a Pull Request.

## ğŸ“„ License

This project is licensed under the [ISC License](LICENSE).
